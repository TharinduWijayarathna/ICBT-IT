on:
  push:
    branches:
      - main

name: ğŸš€ Deploy website on push

jobs:
  web-deploy:
    name: ğŸ‰ Deploy
    runs-on: ubuntu-latest

    steps:
    - name: ğŸšš Get latest code
      uses: actions/checkout@v2.3.2

    - name: ğŸ“‚ Sync files
      uses: SamKirkland/FTP-Deploy-Action@4.0.0
      with:
        server: ftp.testenv.elementfx.com
        username: tharindu@testenv.elementfx.com
        password: Cashmate@123
        server-dir: /

    - name: ğŸ“ Create .env file
      run: |
        echo "DB_CONNECTION=mysql" >> .env
        echo "APP_NAME=Wikum" > .env
        echo "DB_HOST=127.0.0.1" >> .env
        echo "DB_PORT=3306" >> .env
        echo "DB_DATABASE=cvtrbbjr_cashmate" >> .env
        echo "DB_USERNAME=cvtrbbjr_cashmate" >> .env
        echo "DB_PASSWORD=Cashmate@123" >> .env

    - name: ğŸ›  Install PHP dependencies
      run: composer install

    - name: ğŸ” Generate App Key
      run: php artisan key:generate

    - name: ğŸ§¹ Clear Cache and Config
      run: |
        php artisan config:clear
        php artisan cache:clear

    - name: ğŸª Link Storage
      run: |
        php artisan storage:link

    - name: ğŸª Run Migrations
      run: |
        php artisan migrate
        php artisan db:seed

    - name: ğŸš§ Install Vite dependencies
      run: npm install

    - name: âš ï¸ Storage Permissions
      run: chmod -R 777 ./

    - name: ğŸš§ Build assets with Vite
      run: npm run build

   
